---
title: C++函数返回值情况
date: 2016-04-13 11:25:36
tags: C++知识点总结
categories: Communicate
author: Afarways
---
**在一个函数的内部，return的时候返回的都是一个拷贝，不管是变量、对象还是指针都是返回拷贝，但是这个拷贝是浅拷贝。**
<!-- more -->
### 返回值是基本类型
例如：
``` bash
int a = 100;
retutn 100;
```
那么就会返回a的一个拷贝，即100返回，然后a就被销毁了。尽管a被销毁了，但它的副本5还是成功地返回了，所以这样做没有问题。

### 返回值非动态分配(new/malloc)得到的指针
对于非动态分配(new/malloc)得到的指针，像1那么做就会有问题，比如在某个函数内部：
``` bash
int a[] = {1, 2};
return a;
```
那么也会返回指针a的一个拷贝，我们假定a的地址值为0x002345FC，那么这个0x2345FC是能够成功返回的。当return执行完成后，a就要被销毁，也就是0x002345FC所指向的内存被回收了。如果这时候在函数外面，去地址0x002345FC取值，那得到的结果肯定是不对的。这就是为什么不能返回局部指针的原因。返回局部变量的引用的道理和这个类似。

### 返回(动态分配得到的)指针的另外一种情况
对于返回(动态分配得到的)指针的另外一种情况，比如在函数内部：
``` bash
int a = new int(5);
return a;
```
这样做是可以的。return a执行完后，a并没有被销毁(必须要用delete才能销毁a)，所以这里返回的a是有效的。

### 返回值不是基本数据类型
 如果不是基本数据类型，比如：
 ``` bash
 class A
 {
 public:
        OtherClass * ...
 };
 ```
 这时候也会返回a的一个拷贝，如果A没有写深拷贝构造函数，就会调用缺省的拷贝构造函数(浅拷贝)，这样做就会失败的；
如果A中提供了深拷贝构造函数，则这样做就是可以的。
###### 本文总结来源于网络 玄机逸士的博客
